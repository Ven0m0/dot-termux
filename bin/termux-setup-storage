#!/data/data/com.termux/files/usr/bin/env bash
# shellcheck enable=all shell=bash source-path=SCRIPTDIR external-sources=true
set -euo pipefail
STORAGE_DIR="$HOME/storage"
if [[ -d "$STORAGE_DIR" && -w "$STORAGE_DIR/shared" ]]; then
  echo "Storage already setup and writable."; exit 0
fi
echo "Requesting storage access..."
# Ensure we have the correct user ID
USER_ID="0"
if [[ "${TERMUX__USER_ID:-}" =~ ^[0-9]+$ ]]; then
  USER_ID="$TERMUX__USER_ID"
fi
am broadcast --user "$USER_ID" \
  -a "com.termux.app.reload_style" \
  --es "com.termux.app.reload_style" "storage" \
  "com.termux" >/dev/null
echo "Please grant permission in the popup dialog."
echo "If no dialog appears, run 'termux-setup-storage' again."
